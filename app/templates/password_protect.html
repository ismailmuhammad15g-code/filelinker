{% extends "layout.html" %}

{% block title %}Password Protected - FileLink Pro{% endblock %}

{% block content %}
<div class="ms-password-page">
    <div class="ms-password-container">
        <!-- Header -->
        <div class="ms-password-header">
            <div class="ms-breadcrumb">
                <a href="/">Home</a>
                <span class="ms-separator">></span>
                <span class="ms-current">Protected File</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="ms-password-content">
            <div class="ms-password-card">
                <!-- Lock Icon -->
                <div class="ms-lock-section">
                    <div class="ms-lock-icon">
                        <svg width="72" height="72" viewBox="0 0 24 24" fill="#0078d4">
                            <path d="M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10A2,2 0 0,1 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                        </svg>
                    </div>
                    <div class="ms-lock-badge">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#107c10">
                            <path d="M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                        </svg>
                    </div>
                </div>

                <!-- Content -->
                <div class="ms-password-info">
                    <h1 class="ms-password-title">This file is password protected</h1>
                    <p class="ms-password-subtitle">Enter the password to access this file</p>
                </div>

                <!-- Form -->
                <form method="POST" action="{{ url_for('share.share_link', slug=slug) }}" class="ms-password-form" id="passwordForm">
                    <div class="ms-form-group">
                        <label for="password" class="ms-form-label">Password</label>
                        <div class="ms-password-input-wrapper">
                            <input type="password" name="password" id="password" class="ms-password-input" placeholder="Enter password" required autofocus>
                            <button type="button" class="ms-password-toggle" id="togglePassword">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="ms-eye-open">
                                    <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                                </svg>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="ms-eye-closed" style="display: none;">
                                    <path d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="ms-btn ms-btn-primary ms-btn-full" id="submitBtn">
                        <span class="ms-btn-text">Access file</span>
                        <div class="ms-btn-spinner" style="display: none;">
                            <div class="ms-spinner-small"></div>
                        </div>
                    </button>
                </form>

                <!-- Help Text -->
                <div class="ms-password-help">
                    <div class="ms-help-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="#605e5c">
                            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
                        </svg>
                    </div>
                    <p>Don't have the password? Contact the person who shared this link with you.</p>
                </div>

                <!-- Security Notice -->
                <div class="ms-security-notice">
                    <div class="ms-security-icon">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="#107c10">
                            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
                        </svg>
                    </div>
                    <span>Your password is encrypted and secure</span>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');
    const passwordForm = document.getElementById('passwordForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.querySelector('.ms-btn-text');
    const btnSpinner = document.querySelector('.ms-btn-spinner');
    const eyeOpen = document.querySelector('.ms-eye-open');
    const eyeClosed = document.querySelector('.ms-eye-closed');
    
    // Toggle password visibility
    if (togglePassword) {
        togglePassword.addEventListener('click', function() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeOpen.style.display = 'none';
                eyeClosed.style.display = 'block';
            } else {
                passwordInput.type = 'password';
                eyeOpen.style.display = 'block';
                eyeClosed.style.display = 'none';
            }
        });
    }
    
    // Form submission with loading state
    if (passwordForm) {
        passwordForm.addEventListener('submit', function(e) {
            if (passwordInput.value.trim() === '') {
                e.preventDefault();
                passwordInput.focus();
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnSpinner.style.display = 'flex';
        });
    }
    
    // Auto-focus password input
    if (passwordInput) {
        passwordInput.focus();
    }
});
</script>
{% endblock %}